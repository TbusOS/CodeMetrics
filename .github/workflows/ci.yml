name: CodeMetrics CI

on:
  push:
    branches: [ master, main, develop ]
  pull_request:
    branches: [ master, main ]

jobs:
  test:
    name: Test on Python ${{ matrix.python-version }}
    runs-on: ubuntu-latest
    
    strategy:
      matrix:
        python-version: ['3.8', '3.9', '3.10', '3.11', '3.12']
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ Setup Python ${{ matrix.python-version }}
      uses: actions/setup-python@v4
      with:
        python-version: ${{ matrix.python-version }}
    
    - name: ğŸ“Š Display Python version
      run: python -c "import sys; print(sys.version)"
    
    - name: âœ… Test basic functionality
      run: |
        chmod +x codemetrics.py
        python3 codemetrics.py --version
        python3 codemetrics.py --help
    
    - name: ğŸ” Test analysis on self
      run: |
        python3 codemetrics.py . -p organic --no-save
    
    - name: ğŸ“ Test with different parameters
      run: |
        python3 codemetrics.py . -p embedded -n 5 --no-save
        python3 codemetrics.py . -p semi-detached --no-color --no-save

  lint:
    name: Code Quality Check
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“‹ Check Python syntax
      run: |
        python3 -m py_compile codemetrics.py
        echo "âœ… Python syntax check passed"

  analyze:
    name: Self Analysis Report
    runs-on: ubuntu-latest
    
    steps:
    - name: ğŸ“¥ Checkout code
      uses: actions/checkout@v3
    
    - name: ğŸ Setup Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'
    
    - name: ğŸ“Š Analyze CodeMetrics itself
      run: |
        chmod +x codemetrics.py
        python3 codemetrics.py . -p organic
    
    - name: ğŸ“¤ Upload analysis report
      uses: actions/upload-artifact@v3
      with:
        name: codemetrics-report
        path: |
          codemetrics_output/
          *_output/
        if-no-files-found: ignore

